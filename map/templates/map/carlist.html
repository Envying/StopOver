<!--- Displays list of cars by looping through a car list obtain from the db-->
<div class="list-group">
<script>
function getDistanceFromLatLonInKm(lon1, lat1, lon2, lat2) {
	  var R = 6371; // Radius of the earth in km
	  var dLat = deg2rad(lat2-lat1);  // deg2rad below
	  var dLon = deg2rad(lon2-lon1);
	  var a =
	    Math.sin(dLat/2) * Math.sin(dLat/2) +
	    Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) *
	    Math.sin(dLon/2) * Math.sin(dLon/2)
	    ;
	  var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
	  var d = R * c; // Distance in km
	  return d.toFixed(2);

}	  
 function deg2rad(deg) {
	return deg * (Math.PI/180)
}
	
function getSpecificCookie(cookieName, valueOnly) {
 //Get original cookie string
	 var oCookieArray = document.cookie.split(';'),
	     fc,
	     cnRE = new RegExp(cookieName + '\=');
	 //Loop through cookies
	 for (var c = 0; c < oCookieArray.length; c++) {
	 	   //If found save to variable and end loop
	     if (cnRE.test(oCookieArray[c])) {
	         fc = oCookieArray[c].trim();
	         if (valueOnly) {
	             fc = fc.replace(cookieName +'=', '');
	         }
	         break;
	     }
	 }
	 return fc;
}
		    
const longCookie = getSpecificCookie('longitude', true);
const latCookie = getSpecificCookie('latitude', true) ;
</script>
  {% for car in cars %}
  <a href="#" class="list-group-item list-group-item-action flex-column align-items-start">
    <div class="d-flex w-100 justify-content-between">
      <h5 class="mb-1 list-font">{{ car.brand }}<small id="car-trans"> ({{ car.transmission }})</small></h5>
      <small class="list-font">{{ car.number_plate}}</small>
    </div>
      <div class="d-flex w-100 justify-content-between">

          <p class="mb-1">{{ car.transmission }}</p>
            <p><small class="distanceNumber"></small><small> km from you</small></p>
    </div>

    <form method="GET" action="{{ car.get_absolute_url }}">
      <!-- <input type="hidden" name="number_plate" > -->
      <input type="submit" value="Book">
    </form>
  </a>

 <script type="text/javascript">

 	document.getElementsByClassName('distanceNumber')[i].innerHTML = getDistanceFromLatLonInKm({{car.longitude}}, {{car.latitude}}, longCookie, latCookie);

</script>

 {% endfor %}

</div>
